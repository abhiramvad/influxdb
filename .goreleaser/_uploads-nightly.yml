blobs:
  - provider: "s3"
    bucket: "dl.influxdata.com"
    region: "us-east-1"
    folder: "platform/nightlies/"
    extra_files:
      - glob: ./changelog_artifacts/CHANGELOG.md
  # Duplicating the contents to another folder in the bucket ensures
  # scheme parity with release branches; eventually the artifacts should
  # __only__ appear in the branch-specific folder
  - provider: "s3"
    bucket: "dl.influxdata.com"
    region: "us-east-1"
    folder: "platform/nightlies/master/"
    extra_files:
      - glob: ./changelog_artifacts/CHANGELOG.md

dockers:
  - goos: linux
    goarch: amd64
    image_templates:
      - "quay.io/influxdb/influxdb-amd64:nightly"
    dockerfile: docker/influxd/Dockerfile
    extra_files:
      - docker/influxd/entrypoint.sh
    build_flag_templates:
      - "--platform=linux/amd64"
    use_buildx: true

  - goos: linux
    goarch: arm64
    image_templates:
      - "quay.io/influxdb/influxdb-arm64v8:nightly"
    dockerfile: docker/influxd/Dockerfile
    extra_files:
      - docker/influxd/entrypoint.sh
    build_flag_templates:
      - "--platform=linux/arm64/v8"
    use_buildx: true

docker_manifests:
  - name_template: "quay.io/influxdb/influxdb:nightly"
    image_templates:
      - "quay.io/influxdb/influxdb-amd64:nightly"
      - "quay.io/influxdb/influxdb-arm64v8:nightly"
